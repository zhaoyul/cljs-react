shadow$provide.module$node_modules$$firebase$storage$dist$index_cjs=function(global,require,module,exports){function unknown(){return new FirebaseStorageError(Code.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function canceled(){return new FirebaseStorageError(Code.CANCELED,"User canceled the upload/download.")}function cannotSliceBlob(){return new FirebaseStorageError(Code.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function invalidArgument(index,
fnName,message){return new FirebaseStorageError(Code.INVALID_ARGUMENT,"Invalid argument in `"+fnName+"` at index "+index+": "+message)}function appDeleted(){return new FirebaseStorageError(Code.APP_DELETED,"The Firebase app was deleted.")}function invalidFormat(format,message){return new FirebaseStorageError(Code.INVALID_FORMAT,"String does not match format '"+format+"': "+message)}function internalError(message){throw new FirebaseStorageError(Code.INTERNAL_ERROR,"Internal error: "+message);}function formatValidator(stringFormat){switch(stringFormat){case StringFormat.RAW:case StringFormat.BASE64:case StringFormat.BASE64URL:case StringFormat.DATA_URL:break;
default:throw"Expected one of the event types: ["+StringFormat.RAW+", "+StringFormat.BASE64+", "+StringFormat.BASE64URL+", "+StringFormat.DATA_URL+"].";}}function dataFromString(format,stringData){switch(format){case StringFormat.RAW:return new StringData(utf8Bytes_(stringData));case StringFormat.BASE64:case StringFormat.BASE64URL:return new StringData(base64Bytes_(format,stringData));case StringFormat.DATA_URL:format=new DataURLParts(stringData);if(format.base64)var JSCompiler_inline_result=base64Bytes_(StringFormat.BASE64,
format.rest);else{try{JSCompiler_inline_result=decodeURIComponent(format.rest)}catch(e){throw invalidFormat(StringFormat.DATA_URL,"Malformed data URL.");}JSCompiler_inline_result=utf8Bytes_(JSCompiler_inline_result)}stringData=(new DataURLParts(stringData)).contentType;return new StringData(JSCompiler_inline_result,stringData)}throw unknown();}function utf8Bytes_(value){for(var b=[],i=0;i<value.length;i++){var c=value.charCodeAt(i);if(127>=c)b.push(c);else if(2047>=c)b.push(192|c>>6,128|c&63);else if(55296===
(c&64512))if(i<value.length-1&&56320===(value.charCodeAt(i+1)&64512)){var lo=value.charCodeAt(++i);c=65536|(c&1023)<<10|lo&1023;b.push(240|c>>18,128|c>>12&63,128|c>>6&63,128|c&63)}else b.push(239,191,189);else 56320===(c&64512)?b.push(239,191,189):b.push(224|c>>12,128|c>>6&63,128|c&63)}return new Uint8Array(b)}function base64Bytes_(format,value){switch(format){case StringFormat.BASE64:var hasMinus=-1!==value.indexOf("-"),hasUnder=-1!==value.indexOf("_");if(hasMinus||hasUnder)throw invalidFormat(format,
"Invalid character '"+(hasMinus?"-":"_")+"' found: is it base64url encoded?");break;case StringFormat.BASE64URL:hasMinus=-1!==value.indexOf("+");hasUnder=-1!==value.indexOf("/");if(hasMinus||hasUnder)throw invalidFormat(format,"Invalid character '"+(hasMinus?"+":"/")+"' found: is it base64 encoded?");value=value.replace(/-/g,"+").replace(/_/g,"/")}try{var bytes=atob(value)}catch(e){throw invalidFormat(format,"Invalid character found");}format=new Uint8Array(bytes.length);for(value=0;value<bytes.length;value++)format[value]=
bytes.charCodeAt(value);return format}function taskStateFromInternalTaskState(state){switch(state){case InternalTaskState.RUNNING:case InternalTaskState.PAUSING:case InternalTaskState.CANCELING:return TaskState.RUNNING;case InternalTaskState.PAUSED:return TaskState.PAUSED;case InternalTaskState.SUCCESS:return TaskState.SUCCESS;case InternalTaskState.CANCELED:return TaskState.CANCELED;case InternalTaskState.ERROR:return TaskState.ERROR;default:return TaskState.ERROR}}function isJustDef(p){return void 0!==
p}function isObject(p){return"object"===typeof p}function isString(p){return"string"===typeof p||p instanceof String}function isNumber(p){return"number"===typeof p||p instanceof Number}function isNativeBlob(p){return isNativeBlobDefined()&&p instanceof Blob}function isNativeBlobDefined(){return"undefined"!==typeof Blob}function getBlob(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];_i="undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:
void 0;if(void 0!==_i){_i=new _i;for(var i=0;i<args.length;i++)_i.append(args[i]);return _i.getBlob()}if(isNativeBlobDefined())return new Blob(args);throw Error("This browser doesn't seem to support creating Blobs");}function jsonObjectOrNull(s){try{var obj=JSON.parse(s)}catch(e){return null}s=obj;return isObject(s)&&!Array.isArray(s)?obj:null}function child(path,childPath){childPath=childPath.split("/").filter(function(component){return 0<component.length}).join("/");return 0===path.length?childPath:
path+"/"+childPath}function lastComponent(path){var index=path.lastIndexOf("/",path.length-2);return-1===index?path:path.slice(index+1)}function makeUrl(urlPart){return"https://firebasestorage.googleapis.com/v0"+urlPart}function makeQueryString(params){var encode=encodeURIComponent,queryPart="?",key;for(key in params)if(params.hasOwnProperty(key)){var nextPart=encode(key)+"\x3d"+encode(params[key]);queryPart=queryPart+nextPart+"\x26"}return queryPart=queryPart.slice(0,-1)}function noXform_(metadata,
value){return value}function getMappings(){if(mappings_)return mappings_;var mappings=[];mappings.push(new Mapping("bucket"));mappings.push(new Mapping("generation"));mappings.push(new Mapping("metageneration"));mappings.push(new Mapping("name","fullPath",!0));var nameMapping=new Mapping("name");nameMapping.xform=function(_metadata,fullPath){_metadata=!isString(fullPath)||2>fullPath.length?fullPath:lastComponent(fullPath);return _metadata};mappings.push(nameMapping);nameMapping=new Mapping("size");
nameMapping.xform=function(_metadata,size){return null!=size?Number(size):size};mappings.push(nameMapping);mappings.push(new Mapping("timeCreated"));mappings.push(new Mapping("updated"));mappings.push(new Mapping("md5Hash",null,!0));mappings.push(new Mapping("cacheControl",null,!0));mappings.push(new Mapping("contentDisposition",null,!0));mappings.push(new Mapping("contentEncoding",null,!0));mappings.push(new Mapping("contentLanguage",null,!0));mappings.push(new Mapping("contentType",null,!0));mappings.push(new Mapping("metadata",
"customMetadata",!0));return mappings_=mappings}function addRef(metadata,service){Object.defineProperty(metadata,"ref",{get:function(){var loc=new Location$jscomp$0(metadata.bucket,metadata.fullPath);return service.makeStorageReference(loc)}})}function fromResourceString(service,resourceString,mappings){resourceString=jsonObjectOrNull(resourceString);if(null===resourceString)return null;for(var metadata={type:"file"},len=mappings.length,i=0;i<len;i++){var mapping=mappings[i];metadata[mapping.local]=
mapping.xform(metadata,resourceString[mapping.server])}addRef(metadata,service);return metadata}function downloadUrlFromResourceString(metadata,resourceString){resourceString=jsonObjectOrNull(resourceString);if(null===resourceString||!isString(resourceString.downloadTokens))return null;resourceString=resourceString.downloadTokens;if(0===resourceString.length)return null;var encode=encodeURIComponent;return resourceString.split(",").map(function(token){var path=metadata.fullPath;path="/b/"+encode(metadata.bucket)+
"/o/"+encode(path);path=makeUrl(path);token=makeQueryString({alt:"media",token:token});return path+token})[0]}function toResourceString(metadata,mappings){for(var resource={},len=mappings.length,i=0;i<len;i++){var mapping=mappings[i];mapping.writable&&(resource[mapping.server]=metadata[mapping.local])}return JSON.stringify(resource)}function metadataValidator(p){if(!isObject(p)||!p)throw"Expected Metadata object.";for(var key in p)if(p.hasOwnProperty(key)){var val=p[key];if("customMetadata"===key){if(!isObject(val))throw"Expected object for 'customMetadata' mapping.";
}else if(isObject(val)&&null!==val)throw"Mapping for '"+key+"' cannot be an object.";}}function listOptionsValidator(p$jscomp$0){if(!isObject(p$jscomp$0)||!p$jscomp$0)throw"Expected ListOptions object.";for(var key in p$jscomp$0)if("maxResults"===key){var p=p$jscomp$0.maxResults;if(!isNumber(p)||!Number.isInteger(p)||0>=p$jscomp$0.maxResults)throw"Expected maxResults to be a positive number.";if(1E3<p$jscomp$0.maxResults)throw"Expected maxResults to be less than or equal to 1000.";}else if("pageToken"===
key){if(p$jscomp$0.pageToken&&!isString(p$jscomp$0.pageToken))throw"Expected pageToken to be string.";}else throw"Unknown option: "+key;}function handlerCheck(cndn){if(!cndn)throw unknown();}function metadataHandler(service,mappings){return function(xhr,text){xhr=fromResourceString(service,text,mappings);handlerCheck(null!==xhr);return xhr}}function listHandler(service,bucket){return function(xhr,text){text=jsonObjectOrNull(text);if(null===text)xhr=null;else{xhr={prefixes:[],items:[],nextPageToken:text.nextPageToken};
if(text.prefixes)for(var _i=0,_a=text.prefixes;_i<_a.length;_i++){var pathWithoutTrailingSlash=_a[_i].replace(/\/$/,"");pathWithoutTrailingSlash=service.makeStorageReference(new Location$jscomp$0(bucket,pathWithoutTrailingSlash));xhr.prefixes.push(pathWithoutTrailingSlash)}if(text.items)for(_i=0,text=text.items;_i<text.length;_i++)pathWithoutTrailingSlash=service.makeStorageReference(new Location$jscomp$0(bucket,text[_i].name)),xhr.items.push(pathWithoutTrailingSlash)}handlerCheck(null!==xhr);return xhr}}
function downloadUrlHandler(service,mappings){return function(xhr,text){xhr=fromResourceString(service,text,mappings);handlerCheck(null!==xhr);return downloadUrlFromResourceString(xhr,text)}}function sharedErrorHandler(location){return function(xhr,err){xhr=401===xhr.getStatus()?new FirebaseStorageError(Code.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===xhr.getStatus()?new FirebaseStorageError(Code.QUOTA_EXCEEDED,"Quota for bucket '"+
location.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===xhr.getStatus()?new FirebaseStorageError(Code.UNAUTHORIZED,"User does not have permission to access '"+location.path+"'."):err;xhr.setServerResponseProp(err.serverResponseProp());return xhr}}function objectErrorHandler(location){var shared=sharedErrorHandler(location);return function(xhr,err){var newErr=shared(xhr,err);404===xhr.getStatus()&&(newErr=new FirebaseStorageError(Code.OBJECT_NOT_FOUND,"Object '"+
location.path+"' does not exist."));newErr.setServerResponseProp(err.serverResponseProp());return newErr}}function getMetadata(service,location,mappings){var urlPart=location.fullServerUrl();urlPart=makeUrl(urlPart);var timeout=service.maxOperationRetryTime;service=new RequestInfo(urlPart,"GET",metadataHandler(service,mappings),timeout);service.errorHandler=objectErrorHandler(location);return service}function getDownloadUrl(service,location,mappings){var urlPart=location.fullServerUrl();urlPart=makeUrl(urlPart);
var timeout=service.maxOperationRetryTime;service=new RequestInfo(urlPart,"GET",downloadUrlHandler(service,mappings),timeout);service.errorHandler=objectErrorHandler(location);return service}function deleteObject(service,location){var urlPart=location.fullServerUrl();urlPart=makeUrl(urlPart);service=new RequestInfo(urlPart,"DELETE",function(_xhr,_text){},service.maxOperationRetryTime);service.successCodes=[200,204];service.errorHandler=objectErrorHandler(location);return service}function metadataForUpload_(location,
blob,metadata){metadata=Object.assign({},metadata);metadata.fullPath=location.path;metadata.size=blob.size();metadata.contentType||(metadata.contentType=blob&&blob.type()||"application/octet-stream");return metadata}function multipartUpload(service,location,mappings,blob,metadata){var urlPart=location.bucketOnlyServerUrl(),headers={"X-Goog-Upload-Protocol":"multipart"};var boundary="";for(var i=0;2>i;i++)boundary+=Math.random().toString().slice(2);headers["Content-Type"]="multipart/related; boundary\x3d"+
boundary;metadata=metadataForUpload_(location,blob,metadata);i=toResourceString(metadata,mappings);blob=FbsBlob.getBlob("--"+boundary+"\r\nContent-Type: application/json; charset\x3dutf-8\r\n\r\n"+i+"\r\n--"+boundary+"\r\nContent-Type: "+metadata.contentType+"\r\n\r\n",blob,"\r\n--"+boundary+"--");if(null===blob)throw cannotSliceBlob();metadata={name:metadata.fullPath};urlPart=makeUrl(urlPart);boundary=service.maxUploadRetryTime;service=new RequestInfo(urlPart,"POST",metadataHandler(service,mappings),
boundary);service.urlParams=metadata;service.headers=headers;service.body=blob.uploadData();service.errorHandler=sharedErrorHandler(location);return service}function checkResumeHeader_(xhr,allowed){var status=null;try{status=xhr.getResponseHeader("X-Goog-Upload-Status")}catch(e){handlerCheck(!1)}xhr=allowed||["active"];handlerCheck(!!status&&-1!==xhr.indexOf(status));return status}function createResumableUpload(service,location,mappings,blob,metadata){var urlPart=location.bucketOnlyServerUrl(),metadataForUpload=
metadataForUpload_(location,blob,metadata);metadata={name:metadataForUpload.fullPath};urlPart=makeUrl(urlPart);blob={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":blob.size(),"X-Goog-Upload-Header-Content-Type":metadataForUpload.contentType,"Content-Type":"application/json; charset\x3dutf-8"};mappings=toResourceString(metadataForUpload,mappings);service=new RequestInfo(urlPart,"POST",function(xhr){checkResumeHeader_(xhr);try{var url=xhr.getResponseHeader("X-Goog-Upload-URL")}catch(e){handlerCheck(!1)}handlerCheck(isString(url));
return url},service.maxUploadRetryTime);service.urlParams=metadata;service.headers=blob;service.body=mappings;service.errorHandler=sharedErrorHandler(location);return service}function getResumableUploadStatus(service,location,url,blob){service=new RequestInfo(url,"POST",function(xhr){var status=checkResumeHeader_(xhr,["active","final"]),sizeString=null;try{sizeString=xhr.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){handlerCheck(!1)}sizeString||handlerCheck(!1);xhr=Number(sizeString);
handlerCheck(!isNaN(xhr));return new ResumableUploadStatus(xhr,blob.size(),"final"===status)},service.maxUploadRetryTime);service.headers={"X-Goog-Upload-Command":"query"};service.errorHandler=sharedErrorHandler(location);return service}function continueResumableUpload(location,service,url,blob,chunkSize,mappings,status,progressCallback){var status_=new ResumableUploadStatus(0,0);status?(status_.current=status.current,status_.total=status.total):(status_.current=0,status_.total=blob.size());if(blob.size()!==
status_.total)throw new FirebaseStorageError(Code.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");var bytesToUpload=status=status_.total-status_.current;0<chunkSize&&(bytesToUpload=Math.min(bytesToUpload,chunkSize));var startByte=status_.current;chunkSize={"X-Goog-Upload-Command":bytesToUpload===status?"upload, finalize":"upload","X-Goog-Upload-Offset":status_.current};status=blob.slice(startByte,startByte+bytesToUpload);if(null===status)throw cannotSliceBlob();
url=new RequestInfo(url,"POST",function(xhr,text){var uploadStatus=checkResumeHeader_(xhr,["active","final"]),newCurrent=status_.current+bytesToUpload,size=blob.size();xhr="final"===uploadStatus?metadataHandler(service,mappings)(xhr,text):null;return new ResumableUploadStatus(newCurrent,size,"final"===uploadStatus,xhr)},service.maxUploadRetryTime);url.headers=chunkSize;url.body=status.uploadData();url.progressCallback=progressCallback||null;url.errorHandler=sharedErrorHandler(location);return url}
function validate(name,specs,passed){for(var minArgs=specs.length,maxArgs=specs.length,i=0;i<specs.length;i++)if(specs[i].optional){minArgs=i;break}if(!(minArgs<=passed.length&&passed.length<=maxArgs))throw minArgs===maxArgs?(specs=minArgs,minArgs=1===minArgs?"argument":"arguments"):(specs="between "+minArgs+" and "+maxArgs,minArgs="arguments"),new FirebaseStorageError(Code.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+name+"`: Expected "+specs+" "+minArgs+", received "+passed.length+".");
for(i=0;i<passed.length;i++)try{specs[i].validator(passed[i])}catch(e){if(e instanceof Error)throw invalidArgument(i,name,e.message);throw invalidArgument(i,name,e);}}function and_(v1,v2){return function(p){v1(p);v2(p)}}function stringSpec(validator,optional){function stringValidator(p){if(!isString(p))throw"Expected string.";}validator=validator?and_(stringValidator,validator):stringValidator;return new ArgSpec(validator,optional)}function uploadDataSpec(){return new ArgSpec(function(p){if(!(p instanceof
Uint8Array||p instanceof ArrayBuffer||isNativeBlobDefined()&&p instanceof Blob))throw"Expected Blob or File.";})}function nonNegativeNumberSpec(){return new ArgSpec(function(p){if(!(isNumber(p)&&0<=p))throw"Expected a number 0 or greater.";})}function looseObjectSpec(validator,optional){return new ArgSpec(function(p){if(!(null===p||null!=p&&p instanceof Object))throw"Expected an Object.";void 0!==validator&&null!==validator&&validator(p)},optional)}function nullFunctionSpec(optional){return new ArgSpec(function(p){if(null!==
p&&"function"!==typeof p)throw"Expected a Function.";},optional)}function async(f){return function(){for(var argsToForward=[],_i=0;_i<arguments.length;_i++)argsToForward[_i]=arguments[_i];Promise.resolve().then(function(){return f.apply(void 0,argsToForward)})}}function start(f,callback,timeout){function triggerCallback(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];triggeredCallback||(triggeredCallback=!0,callback.apply(null,args))}function callWithDelay(millis){timeoutId=
setTimeout(function(){timeoutId=null;f(handler,2===cancelState)},millis)}function handler(success){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];triggeredCallback||(success?triggerCallback.call.apply(triggerCallback,tslib.__spreadArrays([null,success],args)):2===cancelState||hitTimeout?triggerCallback.call.apply(triggerCallback,tslib.__spreadArrays([null,success],args)):(64>waitSeconds&&(waitSeconds*=2),1===cancelState?(cancelState=2,args=0):args=1E3*(waitSeconds+Math.random()),
callWithDelay(args)))}function stop(wasTimeout){stopped||(stopped=!0,triggeredCallback||(null!==timeoutId?(wasTimeout||(cancelState=2),clearTimeout(timeoutId),callWithDelay(0)):wasTimeout||(cancelState=1)))}var waitSeconds=1,timeoutId=null,hitTimeout=!1,cancelState=0,triggeredCallback=!1,stopped=!1;callWithDelay(0);setTimeout(function(){hitTimeout=!0;stop(!0)},timeout);return stop}function makeRequest(requestInfo,appId,authToken,pool){var queryPart=makeQueryString(requestInfo.urlParams);queryPart=
requestInfo.url+queryPart;var headers=Object.assign({},requestInfo.headers);appId&&(headers["X-Firebase-GMPID"]=appId);null!==authToken&&0<authToken.length&&(headers.Authorization="Firebase "+authToken);headers["X-Firebase-Storage-Version"]="webjs/"+("undefined"!==typeof firebase?firebase.SDK_VERSION:"AppManager");return new NetworkRequest(queryPart,requestInfo.method,headers,requestInfo.body,requestInfo.successCodes,requestInfo.additionalRetryCodes,requestInfo.handler,requestInfo.errorHandler,requestInfo.timeout,
requestInfo.progressCallback,pool)}function factory(container,url){var app=container.getProvider("app").getImmediate();container=container.getProvider("auth-internal");return new StorageService(app,container,new XhrIoPool,url)}function registerStorage(instance){var namespaceExports={TaskState:TaskState,TaskEvent:TaskEvent,StringFormat:StringFormat,Storage:StorageService,Reference:Reference$jscomp$0};instance.INTERNAL.registerComponent((new component$jscomp$0.Component("storage",factory,"PUBLIC")).setServiceProps(namespaceExports).setMultipleInstances(!0));
instance.registerVersion("@firebase/storage","0.3.42")}Object.defineProperty(exports,"__esModule",{value:!0});var firebase=function(ex){return ex&&"object"===typeof ex&&"default"in ex?ex["default"]:ex}(require("module$node_modules$$firebase$app$dist$index_cjs")),tslib=require("module$node_modules$tslib$tslib"),component$jscomp$0=require("module$node_modules$$firebase$component$dist$index_cjs"),FirebaseStorageError=function(){function FirebaseStorageError(code,message){this.code_="storage/"+code;this.message_=
"Firebase Storage: "+message;this.serverResponse_=null;this.name_="FirebaseError"}FirebaseStorageError.prototype.codeProp=function(){return this.code};FirebaseStorageError.prototype.codeEquals=function(code){return"storage/"+code===this.codeProp()};FirebaseStorageError.prototype.serverResponseProp=function(){return this.serverResponse_};FirebaseStorageError.prototype.setServerResponseProp=function(serverResponse){this.serverResponse_=serverResponse};Object.defineProperty(FirebaseStorageError.prototype,
"name",{get:function(){return this.name_},enumerable:!1,configurable:!0});Object.defineProperty(FirebaseStorageError.prototype,"code",{get:function(){return this.code_},enumerable:!1,configurable:!0});Object.defineProperty(FirebaseStorageError.prototype,"message",{get:function(){return this.serverResponse_?this.message_+"\n"+this.serverResponse_:this.message_},enumerable:!1,configurable:!0});Object.defineProperty(FirebaseStorageError.prototype,"serverResponse",{get:function(){return this.serverResponse_},
enumerable:!1,configurable:!0});return FirebaseStorageError}(),Code={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",
NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"},StringFormat={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},StringData=function(){return function(data,
contentType){this.data=data;this.contentType=contentType||null}}(),DataURLParts=function(){return function(dataURL){this.base64=!1;this.contentType=null;var matches=dataURL.match(/^data:([^,]+)?,/);if(null===matches)throw invalidFormat(StringFormat.DATA_URL,"Must be formatted 'data:[\x3cmediatype\x3e][;base64],\x3cdata\x3e");matches=matches[1]||null;if(null!=matches){var JSCompiler_inline_result=7<=matches.length?";base64"===matches.substring(matches.length-7):!1;this.contentType=(this.base64=JSCompiler_inline_result)?
matches.substring(0,matches.length-7):matches}this.rest=dataURL.substring(dataURL.indexOf(",")+1)}}(),TaskEvent={STATE_CHANGED:"state_changed"},InternalTaskState={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"},TaskState={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"},ErrorCode;(function(ErrorCode){ErrorCode[ErrorCode.NO_ERROR=0]="NO_ERROR";ErrorCode[ErrorCode.NETWORK_ERROR=1]="NETWORK_ERROR";
ErrorCode[ErrorCode.ABORT=2]="ABORT"})(ErrorCode||(ErrorCode={}));var NetworkXhrIo=function(){function NetworkXhrIo(){var _this=this;this.sent_=!1;this.xhr_=new XMLHttpRequest;this.errorCode_=ErrorCode.NO_ERROR;this.sendPromise_=new Promise(function(resolve){_this.xhr_.addEventListener("abort",function(){_this.errorCode_=ErrorCode.ABORT;resolve(_this)});_this.xhr_.addEventListener("error",function(){_this.errorCode_=ErrorCode.NETWORK_ERROR;resolve(_this)});_this.xhr_.addEventListener("load",function(){resolve(_this)})})}
NetworkXhrIo.prototype.send=function(url,method,body,headers){if(this.sent_)throw internalError("cannot .send() more than once");this.sent_=!0;this.xhr_.open(method,url,!0);if(null!=headers)for(var key in headers)headers.hasOwnProperty(key)&&this.xhr_.setRequestHeader(key,headers[key].toString());null!=body?this.xhr_.send(body):this.xhr_.send();return this.sendPromise_};NetworkXhrIo.prototype.getErrorCode=function(){if(!this.sent_)throw internalError("cannot .getErrorCode() before sending");return this.errorCode_};
NetworkXhrIo.prototype.getStatus=function(){if(!this.sent_)throw internalError("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}};NetworkXhrIo.prototype.getResponseText=function(){if(!this.sent_)throw internalError("cannot .getResponseText() before sending");return this.xhr_.responseText};NetworkXhrIo.prototype.abort=function(){this.xhr_.abort()};NetworkXhrIo.prototype.getResponseHeader=function(header){return this.xhr_.getResponseHeader(header)};NetworkXhrIo.prototype.addUploadProgressListener=
function(listener){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",listener)};NetworkXhrIo.prototype.removeUploadProgressListener=function(listener){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",listener)};return NetworkXhrIo}(),XhrIoPool=function(){function XhrIoPool(){}XhrIoPool.prototype.createXhrIo=function(){return new NetworkXhrIo};return XhrIoPool}(),FbsBlob=function(){function FbsBlob(data,elideCopy){var size=0,blobType="";isNativeBlob(data)?
(this.data_=data,size=data.size,blobType=data.type):data instanceof ArrayBuffer?(elideCopy?this.data_=new Uint8Array(data):(this.data_=new Uint8Array(data.byteLength),this.data_.set(new Uint8Array(data))),size=this.data_.length):data instanceof Uint8Array&&(elideCopy?this.data_=data:(this.data_=new Uint8Array(data.length),this.data_.set(data)),size=data.length);this.size_=size;this.type_=blobType}FbsBlob.prototype.size=function(){return this.size_};FbsBlob.prototype.type=function(){return this.type_};
FbsBlob.prototype.slice=function(startByte,endByte){if(isNativeBlob(this.data_)){var blob=this.data_;startByte=blob.webkitSlice?blob.webkitSlice(startByte,endByte):blob.mozSlice?blob.mozSlice(startByte,endByte):blob.slice?blob.slice(startByte,endByte):null;return null===startByte?null:new FbsBlob(startByte)}startByte=new Uint8Array(this.data_.buffer,startByte,endByte-startByte);return new FbsBlob(startByte,!0)};FbsBlob.getBlob=function(){for(var args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];
if(isNativeBlobDefined())return args=args.map(function(val){return val instanceof FbsBlob?val.data_:val}),new FbsBlob(getBlob.apply(null,args));args=args.map(function(val){return isString(val)?dataFromString(StringFormat.RAW,val).data:val.data_});var finalLength_1=0;args.forEach(function(array){finalLength_1+=array.byteLength});var merged_1=new Uint8Array(finalLength_1),index_1=0;args.forEach(function(array){for(var i=0;i<array.length;i++)merged_1[index_1++]=array[i]});return new FbsBlob(merged_1,
!0)};FbsBlob.prototype.uploadData=function(){return this.data_};return FbsBlob}(),Location$jscomp$0=function(){function Location(bucket,path){this.bucket=bucket;this.path_=path}Object.defineProperty(Location.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0});Object.defineProperty(Location.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0});Location.prototype.fullServerUrl=function(){var encode=encodeURIComponent;return"/b/"+
encode(this.bucket)+"/o/"+encode(this.path)};Location.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"};Location.makeFromBucketSpec=function(bucketString){try{var bucketLocation=Location.makeFromUrl(bucketString)}catch(e){return new Location(bucketString,"")}if(""===bucketLocation.path)return bucketLocation;throw new FirebaseStorageError(Code.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+bucketString+"'.");};Location.makeFromUrl=function(url){function httpModify(loc){loc.path_=
decodeURIComponent(loc.path)}for(var location=null,firebaseStorageHost="firebasestorage.googleapis.com".replace(/[.]/g,"\\."),groups=[{regex:/^gs:\/\/([A-Za-z0-9.\-_]+)(\/(.*))?$/i,indices:{bucket:1,path:3},postModify:function(loc){"/"===loc.path.charAt(loc.path.length-1)&&(loc.path_=loc.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+firebaseStorageHost+"/v[A-Za-z0-9_]+/b/([A-Za-z0-9.\\-_]+)/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:httpModify},{regex:/^https?:\/\/(?:storage.googleapis.com|storage.cloud.google.com)\/([A-Za-z0-9.\-_]+)\/([^?#]*)/i,
indices:{bucket:1,path:2},postModify:httpModify}],i=0;i<groups.length;i++){firebaseStorageHost=groups[i];var captures=firebaseStorageHost.regex.exec(url);if(captures){location=captures[firebaseStorageHost.indices.bucket];(captures=captures[firebaseStorageHost.indices.path])||(captures="");location=new Location(location,captures);firebaseStorageHost.postModify(location);break}}if(null==location)throw new FirebaseStorageError(Code.INVALID_URL,"Invalid URL '"+url+"'.");return location};return Location}(),
Mapping=function(){return function(server,local,writable,xform){this.server=server;this.local=local||server;this.writable=!!writable;this.xform=xform||noXform_}}(),mappings_=null,RequestInfo=function(){return function(url,method,handler,timeout){this.url=url;this.method=method;this.handler=handler;this.timeout=timeout;this.urlParams={};this.headers={};this.progressCallback=this.errorHandler=this.body=null;this.successCodes=[200];this.additionalRetryCodes=[]}}(),ResumableUploadStatus=function(){return function(current,
total,finalized,metadata){this.current=current;this.total=total;this.finalized=!!finalized;this.metadata=metadata||null}}(),Observer=function(){return function(nextOrObserver,error,complete){"function"===typeof nextOrObserver||null!=error||null!=complete?(this.next=nextOrObserver,this.error=error||null,this.complete=complete||null):(this.next=nextOrObserver.next||null,this.error=nextOrObserver.error||null,this.complete=nextOrObserver.complete||null)}}(),UploadTaskSnapshot=function(){return function(bytesTransferred,
totalBytes,state,metadata,task,ref){this.bytesTransferred=bytesTransferred;this.totalBytes=totalBytes;this.state=state;this.metadata=metadata;this.task=task;this.ref=ref}}(),ArgSpec=function(){return function(validator,optional){var self=this;this.validator=function(p){self.optional&&!isJustDef(p)||validator(p)};this.optional=!!optional}}(),UploadTask=function(){function UploadTask(ref,service,location,mappings,blob,metadata){var _this=this;void 0===metadata&&(metadata=null);this.transferred_=0;this.needToFetchMetadata_=
this.needToFetchStatus_=!1;this.observers_=[];this.request_=this.uploadUrl_=this.error_=null;this.chunkMultiplier_=1;this.reject_=this.resolve_=null;this.ref_=ref;this.service_=service;this.location_=location;this.blob_=blob;this.metadata_=metadata;this.mappings_=mappings;this.resumable_=this.shouldDoResumable_(this.blob_);this.state_=InternalTaskState.RUNNING;this.errorHandler_=function(error){_this.request_=null;_this.chunkMultiplier_=1;error.codeEquals(Code.CANCELED)?(_this.needToFetchStatus_=
!0,_this.completeTransitions_()):(_this.error_=error,_this.transition_(InternalTaskState.ERROR))};this.metadataErrorHandler_=function(error){_this.request_=null;error.codeEquals(Code.CANCELED)?_this.completeTransitions_():(_this.error_=error,_this.transition_(InternalTaskState.ERROR))};this.promise_=new Promise(function(resolve,reject){_this.resolve_=resolve;_this.reject_=reject;_this.start_()});this.promise_.then(null,function(){})}UploadTask.prototype.makeProgressCallback_=function(){var _this=
this,sizeBefore=this.transferred_;return function(loaded){return _this.updateProgress_(sizeBefore+loaded)}};UploadTask.prototype.shouldDoResumable_=function(blob){return 262144<blob.size()};UploadTask.prototype.start_=function(){if(this.state_===InternalTaskState.RUNNING&&null===this.request_)if(this.resumable_)null===this.uploadUrl_?this.createResumable_():this.needToFetchStatus_?this.fetchStatus_():this.needToFetchMetadata_?this.fetchMetadata_():this.continueUpload_();else this.oneShotUpload_()};
UploadTask.prototype.resolveToken_=function(callback){var _this=this;this.service_.getAuthToken().then(function(authToken){switch(_this.state_){case InternalTaskState.RUNNING:callback(authToken);break;case InternalTaskState.CANCELING:_this.transition_(InternalTaskState.CANCELED);break;case InternalTaskState.PAUSING:_this.transition_(InternalTaskState.PAUSED)}})};UploadTask.prototype.createResumable_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=createResumableUpload(_this.service_,
_this.location_,_this.mappings_,_this.blob_,_this.metadata_);authToken=_this.service_.makeRequest(requestInfo,authToken);_this.request_=authToken;authToken.getPromise().then(function(url){_this.request_=null;_this.uploadUrl_=url;_this.needToFetchStatus_=!1;_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.fetchStatus_=function(){var _this=this,url=this.uploadUrl_;this.resolveToken_(function(authToken){var requestInfo=getResumableUploadStatus(_this.service_,_this.location_,
url,_this.blob_);authToken=_this.service_.makeRequest(requestInfo,authToken);_this.request_=authToken;authToken.getPromise().then(function(status){_this.request_=null;_this.updateProgress_(status.current);_this.needToFetchStatus_=!1;status.finalized&&(_this.needToFetchMetadata_=!0);_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.continueUpload_=function(){var _this=this,chunkSize=262144*this.chunkMultiplier_,status=new ResumableUploadStatus(this.transferred_,this.blob_.size()),
url=this.uploadUrl_;this.resolveToken_(function(authToken){try{var requestInfo=continueResumableUpload(_this.location_,_this.service_,url,_this.blob_,chunkSize,_this.mappings_,status,_this.makeProgressCallback_())}catch(e){_this.error_=e;_this.transition_(InternalTaskState.ERROR);return}authToken=_this.service_.makeRequest(requestInfo,authToken);_this.request_=authToken;authToken.getPromise().then(function(newStatus){_this.increaseMultiplier_();_this.request_=null;_this.updateProgress_(newStatus.current);
newStatus.finalized?(_this.metadata_=newStatus.metadata,_this.transition_(InternalTaskState.SUCCESS)):_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.increaseMultiplier_=function(){33554432>262144*this.chunkMultiplier_&&(this.chunkMultiplier_*=2)};UploadTask.prototype.fetchMetadata_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=getMetadata(_this.service_,_this.location_,_this.mappings_);authToken=_this.service_.makeRequest(requestInfo,
authToken);_this.request_=authToken;authToken.getPromise().then(function(metadata){_this.request_=null;_this.metadata_=metadata;_this.transition_(InternalTaskState.SUCCESS)},_this.metadataErrorHandler_)})};UploadTask.prototype.oneShotUpload_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=multipartUpload(_this.service_,_this.location_,_this.mappings_,_this.blob_,_this.metadata_);authToken=_this.service_.makeRequest(requestInfo,authToken);_this.request_=authToken;authToken.getPromise().then(function(metadata){_this.request_=
null;_this.metadata_=metadata;_this.updateProgress_(_this.blob_.size());_this.transition_(InternalTaskState.SUCCESS)},_this.errorHandler_)})};UploadTask.prototype.updateProgress_=function(transferred){var old=this.transferred_;this.transferred_=transferred;this.transferred_!==old&&this.notifyObservers_()};UploadTask.prototype.transition_=function(state){if(this.state_!==state)switch(state){case InternalTaskState.CANCELING:this.state_=state;null!==this.request_&&this.request_.cancel();break;case InternalTaskState.PAUSING:this.state_=
state;null!==this.request_&&this.request_.cancel();break;case InternalTaskState.RUNNING:var wasPaused=this.state_===InternalTaskState.PAUSED;this.state_=state;wasPaused&&(this.notifyObservers_(),this.start_());break;case InternalTaskState.PAUSED:this.state_=state;this.notifyObservers_();break;case InternalTaskState.CANCELED:this.error_=canceled();this.state_=state;this.notifyObservers_();break;case InternalTaskState.ERROR:this.state_=state;this.notifyObservers_();break;case InternalTaskState.SUCCESS:this.state_=
state,this.notifyObservers_()}};UploadTask.prototype.completeTransitions_=function(){switch(this.state_){case InternalTaskState.PAUSING:this.transition_(InternalTaskState.PAUSED);break;case InternalTaskState.CANCELING:this.transition_(InternalTaskState.CANCELED);break;case InternalTaskState.RUNNING:this.start_()}};Object.defineProperty(UploadTask.prototype,"snapshot",{get:function(){var externalState=taskStateFromInternalTaskState(this.state_);return new UploadTaskSnapshot(this.transferred_,this.blob_.size(),
externalState,this.metadata_,this,this.ref_)},enumerable:!1,configurable:!0});UploadTask.prototype.on=function(type,nextOrObserver$jscomp$0,error$jscomp$0,completed){function nextOrObserverValidator(p){try{nextValidator(p);return}catch(e){}try{if(observerValidator(p),!(isJustDef(p.next)||isJustDef(p.error)||isJustDef(p.complete)))throw"";}catch(e$36){throw"Expected a function or an Object with one of `next`, `error`, `complete` properties.";}}function makeBinder(specs){return function(nextOrObserver,
error,complete){null!==specs&&validate("on",specs,arguments);var observer=new Observer(nextOrObserver,error,completed);self.addObserver_(observer);return function(){self.removeObserver_(observer)}}}var nextValidator=nullFunctionSpec(!0).validator,observerValidator=looseObjectSpec(null,!0).validator,specs$jscomp$0=[stringSpec(function(){if(type!==TaskEvent.STATE_CHANGED)throw"Expected one of the event types: ["+TaskEvent.STATE_CHANGED+"].";}),looseObjectSpec(nextOrObserverValidator,!0),nullFunctionSpec(!0),
nullFunctionSpec(!0)];validate("on",specs$jscomp$0,arguments);var self=this;specs$jscomp$0=[looseObjectSpec(function(p){if(null===p)throw"Expected a function or an Object with one of `next`, `error`, `complete` properties.";nextOrObserverValidator(p)}),nullFunctionSpec(!0),nullFunctionSpec(!0)];return isJustDef(nextOrObserver$jscomp$0)||isJustDef(error$jscomp$0)||isJustDef(completed)?makeBinder(null)(nextOrObserver$jscomp$0,error$jscomp$0,completed):makeBinder(specs$jscomp$0)};UploadTask.prototype.then=
function(onFulfilled,onRejected){return this.promise_.then(onFulfilled,onRejected)};UploadTask.prototype.catch=function(onRejected){return this.then(null,onRejected)};UploadTask.prototype.addObserver_=function(observer){this.observers_.push(observer);this.notifyObserver_(observer)};UploadTask.prototype.removeObserver_=function(observer){observer=this.observers_.indexOf(observer);-1!==observer&&this.observers_.splice(observer,1)};UploadTask.prototype.notifyObservers_=function(){var _this=this;this.finishPromise_();
this.observers_.slice().forEach(function(observer){_this.notifyObserver_(observer)})};UploadTask.prototype.finishPromise_=function(){if(null!==this.resolve_){var triggered=!0;switch(taskStateFromInternalTaskState(this.state_)){case TaskState.SUCCESS:async(this.resolve_.bind(null,this.snapshot))();break;case TaskState.CANCELED:case TaskState.ERROR:async(this.reject_.bind(null,this.error_))();break;default:triggered=!1}triggered&&(this.reject_=this.resolve_=null)}};UploadTask.prototype.notifyObserver_=
function(observer){switch(taskStateFromInternalTaskState(this.state_)){case TaskState.RUNNING:case TaskState.PAUSED:observer.next&&async(observer.next.bind(observer,this.snapshot))();break;case TaskState.SUCCESS:observer.complete&&async(observer.complete.bind(observer))();break;case TaskState.CANCELED:case TaskState.ERROR:observer.error&&async(observer.error.bind(observer,this.error_))();break;default:observer.error&&async(observer.error.bind(observer,this.error_))()}};UploadTask.prototype.resume=
function(){validate("resume",[],arguments);var valid=this.state_===InternalTaskState.PAUSED||this.state_===InternalTaskState.PAUSING;valid&&this.transition_(InternalTaskState.RUNNING);return valid};UploadTask.prototype.pause=function(){validate("pause",[],arguments);var valid=this.state_===InternalTaskState.RUNNING;valid&&this.transition_(InternalTaskState.PAUSING);return valid};UploadTask.prototype.cancel=function(){validate("cancel",[],arguments);var valid=this.state_===InternalTaskState.RUNNING||
this.state_===InternalTaskState.PAUSING;valid&&this.transition_(InternalTaskState.CANCELING);return valid};return UploadTask}(),Reference$jscomp$0=function(){function Reference(service,location){this.service=service;this.location=location instanceof Location$jscomp$0?location:Location$jscomp$0.makeFromUrl(location)}Reference.prototype.toString=function(){validate("toString",[],arguments);return"gs://"+this.location.bucket+"/"+this.location.path};Reference.prototype.newRef=function(service,location){return new Reference(service,
location)};Reference.prototype.mappings=function(){return getMappings()};Reference.prototype.child=function(childPath){validate("child",[stringSpec()],arguments);var newPath=child(this.location.path,childPath);newPath=new Location$jscomp$0(this.location.bucket,newPath);return this.newRef(this.service,newPath)};Object.defineProperty(Reference.prototype,"parent",{get:function(){var newPath=this.location.path;if(0===newPath.length)newPath=null;else{var index=newPath.lastIndexOf("/");newPath=-1===index?
"":newPath.slice(0,index)}if(null===newPath)return null;newPath=new Location$jscomp$0(this.location.bucket,newPath);return this.newRef(this.service,newPath)},enumerable:!1,configurable:!0});Object.defineProperty(Reference.prototype,"root",{get:function(){var location=new Location$jscomp$0(this.location.bucket,"");return this.newRef(this.service,location)},enumerable:!1,configurable:!0});Object.defineProperty(Reference.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:!1,configurable:!0});
Object.defineProperty(Reference.prototype,"fullPath",{get:function(){return this.location.path},enumerable:!1,configurable:!0});Object.defineProperty(Reference.prototype,"name",{get:function(){return lastComponent(this.location.path)},enumerable:!1,configurable:!0});Object.defineProperty(Reference.prototype,"storage",{get:function(){return this.service},enumerable:!1,configurable:!0});Reference.prototype.put=function(data,metadata){void 0===metadata&&(metadata=null);validate("put",[uploadDataSpec(),
new ArgSpec(metadataValidator,!0)],arguments);this.throwIfRoot_("put");return new UploadTask(this,this.service,this.location,this.mappings(),new FbsBlob(data),metadata)};Reference.prototype.putString=function(value,format,metadata){void 0===format&&(format=StringFormat.RAW);validate("putString",[stringSpec(),stringSpec(formatValidator,!0),new ArgSpec(metadataValidator,!0)],arguments);this.throwIfRoot_("putString");var data=dataFromString(format,value),metadataClone=Object.assign({},metadata);null==
metadataClone.contentType&&null!=data.contentType&&(metadataClone.contentType=data.contentType);return new UploadTask(this,this.service,this.location,this.mappings(),new FbsBlob(data.data,!0),metadataClone)};Reference.prototype.delete=function(){var _this=this;validate("delete",[],arguments);this.throwIfRoot_("delete");return this.service.getAuthToken().then(function(authToken){var requestInfo=deleteObject(_this.service,_this.location);return _this.service.makeRequest(requestInfo,authToken).getPromise()})};
Reference.prototype.listAll=function(){validate("listAll",[],arguments);var accumulator={prefixes:[],items:[]};return this.listAllHelper(accumulator).then(function(){return accumulator})};Reference.prototype.listAllHelper=function(accumulator,pageToken){return tslib.__awaiter(this,void 0,void 0,function(){var opt,nextPage,_a,_b;return tslib.__generator(this,function(_c){switch(_c.label){case 0:return opt={pageToken:pageToken},[4,this.list(opt)];case 1:return nextPage=_c.sent(),(_a=accumulator.prefixes).push.apply(_a,
nextPage.prefixes),(_b=accumulator.items).push.apply(_b,nextPage.items),null==nextPage.nextPageToken?[3,3]:[4,this.listAllHelper(accumulator,nextPage.nextPageToken)];case 2:_c.sent(),_c.label=3;case 3:return[2]}})})};Reference.prototype.list=function(options){validate("list",[new ArgSpec(listOptionsValidator,!0)],arguments);var self=this;return this.service.getAuthToken().then(function(authToken){var op=options||{},service=self.service,location=self.location,pageToken=op.pageToken,maxResults=op.maxResults;
op={};op.prefix=location.isRoot?"":location.path+"/";op.delimiter="/";pageToken&&(op.pageToken=pageToken);maxResults&&(op.maxResults=maxResults);pageToken=location.bucketOnlyServerUrl();pageToken=makeUrl(pageToken);maxResults=service.maxOperationRetryTime;service=new RequestInfo(pageToken,"GET",listHandler(service,location.bucket),maxResults);service.urlParams=op;service.errorHandler=sharedErrorHandler(location);return self.service.makeRequest(service,authToken).getPromise()})};Reference.prototype.getMetadata=
function(){var _this=this;validate("getMetadata",[],arguments);this.throwIfRoot_("getMetadata");return this.service.getAuthToken().then(function(authToken){var requestInfo=getMetadata(_this.service,_this.location,_this.mappings());return _this.service.makeRequest(requestInfo,authToken).getPromise()})};Reference.prototype.updateMetadata=function(metadata$jscomp$0){var _this=this;validate("updateMetadata",[new ArgSpec(metadataValidator,void 0)],arguments);this.throwIfRoot_("updateMetadata");return this.service.getAuthToken().then(function(authToken){var service=
_this.service,location=_this.location,metadata=metadata$jscomp$0,mappings=_this.mappings(),urlPart=location.fullServerUrl();urlPart=makeUrl(urlPart);metadata=toResourceString(metadata,mappings);var timeout=service.maxOperationRetryTime;service=new RequestInfo(urlPart,"PATCH",metadataHandler(service,mappings),timeout);service.headers={"Content-Type":"application/json; charset\x3dutf-8"};service.body=metadata;service.errorHandler=objectErrorHandler(location);return _this.service.makeRequest(service,
authToken).getPromise()})};Reference.prototype.getDownloadURL=function(){var _this=this;validate("getDownloadURL",[],arguments);this.throwIfRoot_("getDownloadURL");return this.service.getAuthToken().then(function(authToken){var requestInfo=getDownloadUrl(_this.service,_this.location,_this.mappings());return _this.service.makeRequest(requestInfo,authToken).getPromise().then(function(url){if(null===url)throw new FirebaseStorageError(Code.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");
return url})})};Reference.prototype.throwIfRoot_=function(name){if(""===this.location.path)throw new FirebaseStorageError(Code.INVALID_ROOT_OPERATION,"The operation '"+name+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').");};return Reference}(),FailRequest=function(){function FailRequest(error){this.promise_=Promise.reject(error)}FailRequest.prototype.getPromise=function(){return this.promise_};FailRequest.prototype.cancel=function(_appDelete){};
return FailRequest}(),NetworkRequest=function(){function NetworkRequest(url,method,headers,body,successCodes,additionalRetryCodes,callback,errorCallback,timeout,progressCallback,pool){var _this=this;this.reject_=this.resolve_=this.backoffId_=this.pendingXhr_=null;this.appDelete_=this.canceled_=!1;this.url_=url;this.method_=method;this.headers_=headers;this.body_=body;this.successCodes_=successCodes.slice();this.additionalRetryCodes_=additionalRetryCodes.slice();this.callback_=callback;this.errorCallback_=
errorCallback;this.progressCallback_=progressCallback;this.timeout_=timeout;this.pool_=pool;this.promise_=new Promise(function(resolve,reject){_this.resolve_=resolve;_this.reject_=reject;_this.start_()})}NetworkRequest.prototype.start_=function(){function doTheRequest(backoffCallback,canceled){function progressListener(progressEvent){var loaded=progressEvent.loaded;progressEvent=progressEvent.lengthComputable?progressEvent.total:-1;null!==self.progressCallback_&&self.progressCallback_(loaded,progressEvent)}
canceled?backoffCallback(!1,new RequestEndStatus(!1,null,!0)):(canceled=self.pool_.createXhrIo(),self.pendingXhr_=canceled,null!==self.progressCallback_&&canceled.addUploadProgressListener(progressListener),canceled.send(self.url_,self.method_,self.body_,self.headers_).then(function(xhr){null!==self.progressCallback_&&xhr.removeUploadProgressListener(progressListener);self.pendingXhr_=null;var hitServer=xhr.getErrorCode()===ErrorCode.NO_ERROR,status=xhr.getStatus();!hitServer||self.isRetryStatusCode_(status)?
(xhr=xhr.getErrorCode()===ErrorCode.ABORT,backoffCallback(!1,new RequestEndStatus(!1,null,xhr))):(hitServer=-1!==self.successCodes_.indexOf(status),backoffCallback(!0,new RequestEndStatus(hitServer,xhr)))}))}function backoffDone(requestWentThrough,status){var resolve=self.resolve_;requestWentThrough=self.reject_;var xhr=status.xhr;if(status.wasSuccessCode)try{var result=self.callback_(xhr,xhr.getResponseText());isJustDef(result)?resolve(result):resolve()}catch(e){requestWentThrough(e)}else null!==
xhr?(status=unknown(),status.setServerResponseProp(xhr.getResponseText()),self.errorCallback_?requestWentThrough(self.errorCallback_(xhr,status)):requestWentThrough(status)):(status=status.canceled?self.appDelete_?appDeleted():canceled():new FirebaseStorageError(Code.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."),requestWentThrough(status))}var self=this;this.canceled_?backoffDone(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(doTheRequest,backoffDone,
this.timeout_)};NetworkRequest.prototype.getPromise=function(){return this.promise_};NetworkRequest.prototype.cancel=function(appDelete){this.canceled_=!0;this.appDelete_=appDelete||!1;null!==this.backoffId_&&(0,this.backoffId_)(!1);null!==this.pendingXhr_&&this.pendingXhr_.abort()};NetworkRequest.prototype.isRetryStatusCode_=function(status){var isFiveHundredCode=500<=status&&600>status,isExtraRetryCode=-1!==[408,429].indexOf(status);status=-1!==this.additionalRetryCodes_.indexOf(status);return isFiveHundredCode||
isExtraRetryCode||status};return NetworkRequest}(),RequestEndStatus=function(){return function(wasSuccessCode,xhr,canceled){this.wasSuccessCode=wasSuccessCode;this.xhr=xhr;this.canceled=!!canceled}}(),StorageService=function(){function StorageService(app,authProvider,pool,url){var _a;this.appId_=this.bucket_=null;this.deleted_=!1;this.app_=app;this.authProvider_=authProvider;this.maxOperationRetryTime_=12E4;this.maxUploadRetryTime_=6E5;this.requests_=new Set;this.pool_=pool;this.bucket_=null!=url?
Location$jscomp$0.makeFromBucketSpec(url):StorageService.extractBucket_(null===(_a=this.app_)||void 0===_a?void 0:_a.options);this.internals_=new ServiceInternals(this)}StorageService.extractBucket_=function(config){config=null===config||void 0===config?void 0:config.storageBucket;return null==config?null:Location$jscomp$0.makeFromBucketSpec(config)};StorageService.prototype.getAuthToken=function(){return tslib.__awaiter(this,void 0,void 0,function(){var auth,tokenData;return tslib.__generator(this,
function(_a){switch(_a.label){case 0:return(auth=this.authProvider_.getImmediate({optional:!0}))?[4,auth.getToken()]:[3,2];case 1:tokenData=_a.sent();if(null!==tokenData)return[2,tokenData.accessToken];_a.label=2;case 2:return[2,null]}})})};StorageService.prototype.deleteApp=function(){this.deleted_=!0;this.app_=null;this.requests_.forEach(function(request){return request.cancel()});this.requests_.clear()};StorageService.prototype.makeStorageReference=function(loc){return new Reference$jscomp$0(this,
loc)};StorageService.prototype.makeRequest=function(requestInfo,authToken){var _this=this;if(this.deleted_)return new FailRequest(appDeleted());var request_1=makeRequest(requestInfo,this.appId_,authToken,this.pool_);this.requests_.add(request_1);request_1.getPromise().then(function(){return _this.requests_.delete(request_1)},function(){return _this.requests_.delete(request_1)});return request_1};StorageService.prototype.ref=function(path$jscomp$0){validate("ref",[stringSpec(function(path){if("string"!==
typeof path)throw"Path is not a string.";if(/^[A-Za-z]+:\/\//.test(path))throw"Expected child path but got a URL, use refFromURL instead.";},!0)],arguments);if(null==this.bucket_)throw Error("No Storage Bucket defined in Firebase Options.");var ref=new Reference$jscomp$0(this,this.bucket_);return null!=path$jscomp$0?ref.child(path$jscomp$0):ref};StorageService.prototype.refFromURL=function(url){validate("refFromURL",[stringSpec(function(p){if("string"!==typeof p)throw"Path is not a string.";if(!/^[A-Za-z]+:\/\//.test(p))throw"Expected full URL but got a child path, use ref instead.";
try{Location$jscomp$0.makeFromUrl(p)}catch(e){throw"Expected valid full URL but got an invalid one.";}},!1)],arguments);return new Reference$jscomp$0(this,url)};Object.defineProperty(StorageService.prototype,"maxUploadRetryTime",{get:function(){return this.maxUploadRetryTime_},enumerable:!1,configurable:!0});StorageService.prototype.setMaxUploadRetryTime=function(time){validate("setMaxUploadRetryTime",[nonNegativeNumberSpec()],arguments);this.maxUploadRetryTime_=time};Object.defineProperty(StorageService.prototype,
"maxOperationRetryTime",{get:function(){return this.maxOperationRetryTime_},enumerable:!1,configurable:!0});StorageService.prototype.setMaxOperationRetryTime=function(time){validate("setMaxOperationRetryTime",[nonNegativeNumberSpec()],arguments);this.maxOperationRetryTime_=time};Object.defineProperty(StorageService.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0});Object.defineProperty(StorageService.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:!1,
configurable:!0});return StorageService}(),ServiceInternals=function(){function ServiceInternals(service){this.service_=service}ServiceInternals.prototype.delete=function(){this.service_.deleteApp();return Promise.resolve()};return ServiceInternals}();registerStorage(firebase);exports.registerStorage=registerStorage}
//# sourceMappingURL=module$node_modules$$firebase$storage$dist$index_cjs.js.map
